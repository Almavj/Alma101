:80
root * ./
encode gzip zstd

# API requests - Serve from backend directory
handle /api/* {
    # CRITICAL: Set root to the backend directory
    root * ./backend
    
    # Remove the /api prefix from the path before looking for files
    @apiPath {
        path_regexp ^/api/(.*)
    }
    handle @apiPath {
        rewrite * /{re.path.1}
        php
        file_server
    }
    
    # Fallback for any other /api/* requests
    php
    file_server
}

# Everything else - SPA
handle {
    try_files {path} {path}/ /index.html
    file_server
}